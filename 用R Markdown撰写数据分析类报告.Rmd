---
title: "用R Markdown撰写数据分析类报告"
author: "吴建祖"
date: "2020年1月13日"
output:
  html_document: default
  word_document: default
---

R Markdown是通过R语言制作可重复动态报告的一种文件格式。R Markdown文档编辑需要 rmarkdown包，rmarkdown安装需要RStudio编辑器环境。关于R Markdown的进一步技术细节，网上有海量资料，请自行搜索。下面分别通过用R、Stata和Python做数据分析的例子来简要展示用R Markdown撰写的数据分析类报告的效果。这只是一个极简的例子，有机会再进一步完善。

### 一、用R做数据分析

#### 例子：分类树

加载R包

```{r}
library(tree)
library(ISLR)
```

数据准备

```{r}
attach(Carseats)
High=ifelse(Sales<=8,"No","Yes")
Carseats=data.frame(Carseats,High)
```

生成分类树

```{r}
tree.carseats=tree(High~.-Sales,Carseats)
summary(tree.carseats)
```

分类树图示

```{r}
plot(tree.carseats)
text(tree.carseats,pretty=0)
```

### 二、用Stata做数据分析

#### 例子：回归分析和散点图

加载R包Statamarkdown

```{r}
library(Statamarkdown)
```

回归分析

```{stata}
sysuse auto, clear
reg price mpg rep78 headroom trunk weight length turn displacement gear_ratio foreign, r
```

画散点图

```
twoway (scatter price length), scheme(cleanplots)
graph export "scatter.png", replace
```

```{stata, echo=FALSE, results="hide"}
sysuse auto, clear
twoway (scatter price length), scheme(cleanplots)
graph export "scatter.png", replace
```

![](scatter.png)

### 三、用Python做数据分析

#### 例子：回归树

加载R包reticulate

```{r}
library(reticulate)
```

加载Python包

```{python}
import numpy as np
from sklearn.tree import DecisionTreeRegressor
import matplotlib
import matplotlib.pyplot as plt
```

生成数据

```{python}
rng = np.random.RandomState(1)
X = np.sort(5 * rng.rand(80, 1), axis=0)
y = np.sin(X).ravel()
y[::5] += 3 * (0.5 - rng.rand(16))
```

回归树模型

```{python}
regr_1 = DecisionTreeRegressor(max_depth=2)
regr_2 = DecisionTreeRegressor(max_depth=5)
regr_1.fit(X, y)
regr_2.fit(X, y)
```

预测

```{python}
X_test = np.arange(0.0, 5.0, 0.01)[:, np.newaxis]
y_1 = regr_1.predict(X_test)
y_2 = regr_2.predict(X_test)
```

回归树图示

```
plt.figure()
plt.scatter(X, y, s=20, edgecolor="black",
            c="darkorange", label="data")
plt.plot(X_test, y_1, color="cornflowerblue",
         label="max_depth=2", linewidth=2)
plt.plot(X_test, y_2, color="yellowgreen", label="max_depth=5", linewidth=2)
plt.xlabel("data")
plt.ylabel("target")
plt.title("Decision Tree Regression")
plt.legend()
plt.show()
fig.savefig('Decision_Tree_Regression.png')
```
![](Decision_Tree_Regression.png)
